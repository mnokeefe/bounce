!function(){var e={},t={};!function(){var e=1;t.create=function(e){var t={id:f.nextId(),type:"body",label:"Body",angle:0,vertices:M.fromPath("L 0 0 L 40 0 L 40 40 L 0 40"),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,friction:.1,frictionAir:.01,groupId:0,slop:.05,timeScale:1,render:{visible:!0,sprite:{xScale:1,yScale:1},lineWidth:1.5}},n=f.extend(t,e);return o(n),n},t.nextGroupId=function(){return e++};var o=function(e){e.axes=e.axes||S.fromVertices(e.vertices),e.area=M.area(e.vertices),e.bounds=A.create(e.vertices),e.mass=e.mass||e.density*e.area,e.inverseMass=1/e.mass,e.inertia=e.inertia||M.inertia(e.vertices,e.mass),e.inverseInertia=1/e.inertia,e.positionPrev=e.positionPrev||{x:e.position.x,y:e.position.y},e.anglePrev=e.anglePrev||e.angle,e.render.fillStyle=e.render.fillStyle||(e.isStatic?"#eeeeee":f.choose(["#556270","#4ECDC4","#C7F464","#FF6B6B","#C44D58"])),e.render.strokeStyle=e.render.strokeStyle||f.shadeColor(e.render.fillStyle,-20),M.create(e.vertices,e);var o=M.centre(e.vertices);M.translate(e.vertices,e.position),M.translate(e.vertices,o,-1),M.rotate(e.vertices,e.angle,e.position),S.rotate(e.axes,e.angle),A.update(e.bounds,e.vertices,e.velocity),t.setStatic(e,e.isStatic),g.set(e,e.isSleeping)};t.setStatic=function(e,t){e.isStatic=t,t&&(e.restitution=0,e.friction=1,e.mass=e.inertia=e.density=1/0,e.inverseMass=e.inverseInertia=0,e.render.lineWidth=1,e.positionPrev.x=e.position.x,e.positionPrev.y=e.position.y,e.anglePrev=e.angle,e.angularVelocity=0,e.speed=0,e.angularSpeed=0,e.motion=0)},t.resetForcesAll=function(e){for(var t=0;t<e.length;t++){var o=e[t];o.force.x=0,o.force.y=0,o.torque=0}},t.applyGravityAll=function(e,t){for(var o=0;o<e.length;o++){var n=e[o];n.isStatic||n.isSleeping||(n.force.y+=n.mass*t.y*.001,n.force.x+=n.mass*t.x*.001)}},t.updateAll=function(e,o,n,i,r){for(var s=0;s<e.length;s++){var a=e[s];a.isStatic||a.isSleeping||a.bounds.max.x<r.min.x||a.bounds.min.x>r.max.x||a.bounds.max.y<r.min.y||a.bounds.min.y>r.max.y||t.update(a,o,n,i)}},t.update=function(e,t,o,n){var i=Math.pow(t*o*e.timeScale,2),r=1-e.frictionAir*o*e.timeScale,s=e.position.x-e.positionPrev.x,a=e.position.y-e.positionPrev.y;e.velocity.x=s*r*n+e.force.x/e.mass*i,e.velocity.y=a*r*n+e.force.y/e.mass*i,e.positionPrev.x=e.position.x,e.positionPrev.y=e.position.y,e.position.x+=e.velocity.x,e.position.y+=e.velocity.y,e.angularVelocity=(e.angle-e.anglePrev)*r*n+e.torque/e.inertia*i,e.anglePrev=e.angle,e.angle+=e.angularVelocity,e.speed=B.magnitude(e.velocity),e.angularSpeed=Math.abs(e.angularVelocity),M.translate(e.vertices,e.velocity),0!==e.angularVelocity&&(M.rotate(e.vertices,e.angularVelocity,e.position),S.rotate(e.axes,e.angularVelocity)),A.update(e.bounds,e.vertices,e.velocity)},t.applyForce=function(e,t,o){e.force.x+=o.x,e.force.y+=o.y;var n={x:t.x-e.position.x,y:t.y-e.position.y};e.torque+=(n.x*o.y-n.y*o.x)*e.inverseInertia},t.translate=function(e,t){e.positionPrev.x+=t.x,e.positionPrev.y+=t.y,e.position.x+=t.x,e.position.y+=t.y,M.translate(e.vertices,t),A.update(e.bounds,e.vertices,e.velocity)},t.rotate=function(e,t){e.anglePrev+=t,e.angle+=t,M.rotate(e.vertices,t,e.position),S.rotate(e.axes,t),A.update(e.bounds,e.vertices,e.velocity)},t.scale=function(e,t,o,n){M.scale(e.vertices,t,o,n),e.axes=S.fromVertices(e.vertices),e.area=M.area(e.vertices),e.mass=e.density*e.area,e.inverseMass=1/e.mass,M.translate(e.vertices,{x:-e.position.x,y:-e.position.y}),e.inertia=M.inertia(e.vertices,e.mass),e.inverseInertia=1/e.inertia,M.translate(e.vertices,{x:e.position.x,y:e.position.y}),A.update(e.bounds,e.vertices,e.velocity)}}();var o={};!function(){o.create=function(e){return f.extend({id:f.nextId(),type:"composite",parent:null,isModified:!1,bodies:[],constraints:[],composites:[],label:"Composite"},e)},o.setModified=function(e,t,n,i){if(e.isModified=t,n&&e.parent&&o.setModified(e.parent,t,n,i),i)for(var r=0;r<e.composites.length;r++){var s=e.composites[r];o.setModified(s,t,n,i)}},o.add=function(e,t){for(var n=[].concat(t),i=0;i<n.length;i++){var r=n[i];switch(r.type){case"body":o.addBody(e,r);break;case"constraint":o.addConstraint(e,r);break;case"composite":o.addComposite(e,r);break;case"mouseConstraint":o.addConstraint(e,r.constraint)}}return e},o.remove=function(e,t,n){for(var i=[].concat(t),r=0;r<i.length;r++){var s=i[r];switch(s.type){case"body":o.removeBody(e,s,n);break;case"constraint":o.removeConstraint(e,s,n);break;case"composite":o.removeComposite(e,s,n);break;case"mouseConstraint":o.removeConstraint(e,s.constraint)}}return e},o.addComposite=function(e,t){return e.composites.push(t),t.parent=e,o.setModified(e,!0,!0,!1),e},o.removeComposite=function(e,t,n){var i=e.composites.indexOf(t);if(-1!==i&&(o.removeCompositeAt(e,i),o.setModified(e,!0,!0,!1)),n)for(var r=0;r<e.composites.length;r++)o.removeComposite(e.composites[r],t,!0);return e},o.removeCompositeAt=function(e,t){return e.composites.splice(t,1),o.setModified(e,!0,!0,!1),e},o.addBody=function(e,t){return e.bodies.push(t),o.setModified(e,!0,!0,!1),e},o.removeBody=function(e,t,n){var i=e.bodies.indexOf(t);if(-1!==i&&(o.removeBodyAt(e,i),o.setModified(e,!0,!0,!1)),n)for(var r=0;r<e.composites.length;r++)o.removeBody(e.composites[r],t,!0);return e},o.removeBodyAt=function(e,t){return e.bodies.splice(t,1),o.setModified(e,!0,!0,!1),e},o.addConstraint=function(e,t){return e.constraints.push(t),o.setModified(e,!0,!0,!1),e},o.removeConstraint=function(e,t,n){var i=e.constraints.indexOf(t);if(-1!==i&&o.removeConstraintAt(e,i),n)for(var r=0;r<e.composites.length;r++)o.removeConstraint(e.composites[r],t,!0);return e},o.removeConstraintAt=function(e,t){return e.constraints.splice(t,1),o.setModified(e,!0,!0,!1),e},o.clear=function(e,t,n){if(n)for(var i=0;i<e.composites.length;i++)o.clear(e.composites[i],t,!0);return t?e.bodies=e.bodies.filter(function(e){return e.isStatic}):e.bodies.length=0,e.constraints.length=0,e.composites.length=0,o.setModified(e,!0,!0,!1),e},o.allBodies=function(e){for(var t=[].concat(e.bodies),n=0;n<e.composites.length;n++)t=t.concat(o.allBodies(e.composites[n]));return t},o.allConstraints=function(e){for(var t=[].concat(e.constraints),n=0;n<e.composites.length;n++)t=t.concat(o.allConstraints(e.composites[n]));return t},o.allComposites=function(e){for(var t=[].concat(e.composites),n=0;n<e.composites.length;n++)t=t.concat(o.allComposites(e.composites[n]));return t},o.get=function(e,t,n){var i,r;switch(n){case"body":i=o.allBodies(e);break;case"constraint":i=o.allConstraints(e);break;case"composite":i=o.allComposites(e).concat(e)}return i?(r=i.filter(function(e){return e.id.toString()===t.toString()}),0===r.length?null:r[0]):null},o.move=function(e,t,n){return o.remove(e,t),o.add(n,t),e},o.rebase=function(e){for(var t=o.allBodies(e).concat(o.allConstraints(e)).concat(o.allComposites(e)),n=0;n<t.length;n++)t[n].id=f.nextId();return o.setModified(e,!0,!0,!1),e}}();var n={};!function(){n.create=function(e){var t=o.create(),n={label:"World",gravity:{x:0,y:1},bounds:{min:{x:0,y:0},max:{x:800,y:600}}};return f.extend(t,n,e)}}();var i={};!function(){i.create=function(e){return{id:i.id(e),vertex:e,normalImpulse:0,tangentImpulse:0}},i.id=function(e){return e.body.id+"_"+e.index}}();var r={};!function(){r.collisions=function(e,t){for(var o=[],n=t.metrics,i=t.pairs.table,r=0;r<e.length;r++){var s=e[r][0],l=e[r][1];if(!(s.groupId&&l.groupId&&s.groupId===l.groupId||(s.isStatic||s.isSleeping)&&(l.isStatic||l.isSleeping)||(n.midphaseTests+=1,!A.overlaps(s.bounds,l.bounds)))){var c,d=a.id(s,l),p=i[d];c=p&&p.isActive?p.collision:null;var v=u.collides(s,l,c);n.narrowphaseTests+=1,v.reused&&(n.narrowReuseCount+=1),v.collided&&(o.push(v),n.narrowDetections+=1)}}return o},r.bruteForce=function(e,t){for(var o=[],n=t.metrics,i=t.pairs.table,r=0;r<e.length;r++)for(var s=r+1;s<e.length;s++){var l=e[r],c=e[s];if(!(l.groupId&&c.groupId&&l.groupId===c.groupId||(l.isStatic||l.isSleeping)&&(c.isStatic||c.isSleeping)||(n.midphaseTests+=1,!A.overlaps(l.bounds,c.bounds)))){var d,p=a.id(l,c),v=i[p];d=v&&v.isActive?v.collision:null;var f=u.collides(l,c,d);n.narrowphaseTests+=1,f.reused&&(n.narrowReuseCount+=1),f.collided&&(o.push(f),n.narrowDetections+=1)}}return o}}();var s={};!function(){s.create=function(e,t){return{buckets:{},pairs:{},pairsList:[],bucketWidth:e||48,bucketHeight:t||48}},s.update=function(o,s,a,d){var u,p,v,f,y,m=a.world,x=o.buckets,h=a.metrics,g=!1;for(h.broadphaseTests=0,u=0;u<s.length;u++){var b=s[u];if((!b.isSleeping||d)&&!(b.bounds.max.x<0||b.bounds.min.x>m.bounds.width||b.bounds.max.y<0||b.bounds.min.y>m.bounds.height)){var w=t(o,b);if(!b.region||w.id!==b.region.id||d){h.broadphaseTests+=1,(!b.region||d)&&(b.region=w);var S=e(w,b.region);for(p=S.startCol;p<=S.endCol;p++)for(v=S.startRow;v<=S.endRow;v++){y=n(p,v),f=x[y];var A=p>=w.startCol&&p<=w.endCol&&v>=w.startRow&&v<=w.endRow,B=p>=b.region.startCol&&p<=b.region.endCol&&v>=b.region.startRow&&v<=b.region.endRow;!A&&B&&B&&f&&l(o,f,b),(b.region===w||A&&!B||d)&&(f||(f=i(x,y)),r(o,f,b))}b.region=w,g=!0}}}g&&(o.pairsList=c(o))},s.clear=function(e){e.buckets={},e.pairs={},e.pairsList=[]};var e=function(e,t){var n=Math.min(e.startCol,t.startCol),i=Math.max(e.endCol,t.endCol),r=Math.min(e.startRow,t.startRow),s=Math.max(e.endRow,t.endRow);return o(n,i,r,s)},t=function(e,t){var n=t.bounds,i=Math.floor(n.min.x/e.bucketWidth),r=Math.floor(n.max.x/e.bucketWidth),s=Math.floor(n.min.y/e.bucketHeight),a=Math.floor(n.max.y/e.bucketHeight);return o(i,r,s,a)},o=function(e,t,o,n){return{id:e+","+t+","+o+","+n,startCol:e,endCol:t,startRow:o,endRow:n}},n=function(e,t){return e+","+t},i=function(e,t){var o=e[t]=[];return o},r=function(e,t,o){for(var n=0;n<t.length;n++){var i=t[n];if(!(o.id===i.id||o.isStatic&&i.isStatic)){var r=a.id(o,i),s=e.pairs[r];s?s[2]+=1:e.pairs[r]=[o,i,1]}}t.push(o)},l=function(e,t,o){t.splice(t.indexOf(o),1);for(var n=0;n<t.length;n++){var i=t[n],r=a.id(o,i),s=e.pairs[r];s&&(s[2]-=1)}},c=function(e){var t,o,n=[];t=f.keys(e.pairs);for(var i=0;i<t.length;i++)o=e.pairs[t[i]],o[2]>0?n.push(o):delete e.pairs[t[i]];return n}}();var a={};!function(){a.create=function(e,t){var o=e.bodyA,n=e.bodyB,i={id:a.id(o,n),bodyA:o,bodyB:n,contacts:{},activeContacts:[],separation:0,isActive:!0,timeCreated:t,timeUpdated:t,inverseMass:o.inverseMass+n.inverseMass,friction:Math.min(o.friction,n.friction),restitution:Math.max(o.restitution,n.restitution),slop:Math.max(o.slop,n.slop)};return a.update(i,e,t),i},a.update=function(e,t,o){var n=e.contacts,r=t.supports,s=e.activeContacts;if(e.collision=t,s.length=0,t.collided){for(var l=0;l<r.length;l++){var c=r[l],d=i.id(c),u=n[d];s.push(u?u:n[d]=i.create(c))}e.separation=t.depth,a.setActive(e,!0,o)}else e.isActive===!0&&a.setActive(e,!1,o)},a.setActive=function(e,t,o){t?(e.isActive=!0,e.timeUpdated=o):(e.isActive=!1,e.activeContacts.length=0)},a.id=function(e,t){return e.id<t.id?e.id+"_"+t.id:t.id+"_"+e.id}}();var l={};!function(){var e=1e3;l.create=function(e){return f.extend({table:{},list:[],collisionStart:[],collisionActive:[],collisionEnd:[]},e)},l.update=function(e,t,o){var n,i,r,s,l=e.list,c=e.table,d=e.collisionStart,u=e.collisionEnd,p=e.collisionActive,v=[];for(d.length=0,u.length=0,p.length=0,s=0;s<t.length;s++)n=t[s],n.collided&&(i=a.id(n.bodyA,n.bodyB),v.push(i),r=c[i],r?(r.isActive?p.push(r):d.push(r),a.update(r,n,o)):(r=a.create(n,o),c[i]=r,d.push(r),l.push(r)));for(s=0;s<l.length;s++)r=l[s],r.isActive&&-1===v.indexOf(r.id)&&(a.setActive(r,!1,o),u.push(r))},l.removeOld=function(t,o){var n,i,r,s,a=t.list,l=t.table,c=[];for(s=0;s<a.length;s++)n=a[s],i=n.collision,i.bodyA.isSleeping||i.bodyB.isSleeping?n.timeUpdated=o:o-n.timeUpdated>e&&c.push(s);for(s=0;s<c.length;s++)r=c[s]-s,n=a[r],delete l[n.id],a.splice(r,1)},l.clear=function(e){return e.table={},e.list.length=0,e.collisionStart.length=0,e.collisionActive.length=0,e.collisionEnd.length=0,e}}();var c={};!function(){c.ray=function(e,t,o,n){n=n||Number.MIN_VALUE;for(var i=B.angle(t,o),r=B.magnitude(B.sub(t,o)),s=.5*(o.x+t.x),a=.5*(o.y+t.y),l=b.rectangle(s,a,r,n,{angle:i}),c=[],d=0;d<e.length;d++){var p=e[d];if(A.overlaps(p.bounds,l.bounds)){var v=u.collides(p,l);v.collided&&(v.body=v.bodyA=v.bodyB=p,c.push(v))}}return c},c.region=function(e,t,o){for(var n=[],i=0;i<e.length;i++){var r=e[i],s=A.overlaps(r.bounds,t);(s&&!o||!s&&o)&&n.push(r)}return n}}();var d={};!function(){var e=4,t=.2,o=.6;d.solvePosition=function(e,o){var n,i,r,s,a,l,c,d,u;for(n=0;n<e.length;n++)i=e[n],i.isActive&&(r=i.collision,s=r.bodyA,a=r.bodyB,l=r.supports[0],c=r.supportCorrected,d=r.normal,u=B.sub(B.add(a.positionImpulse,l),B.add(s.positionImpulse,c)),i.separation=B.dot(d,u));for(n=0;n<e.length;n++)i=e[n],i.isActive&&(r=i.collision,s=r.bodyA,a=r.bodyB,d=r.normal,positionImpulse=(i.separation*t-i.slop)*o,(s.isStatic||a.isStatic)&&(positionImpulse*=2),s.isStatic||s.isSleeping||(s.positionImpulse.x+=d.x*positionImpulse,s.positionImpulse.y+=d.y*positionImpulse),a.isStatic||a.isSleeping||(a.positionImpulse.x-=d.x*positionImpulse,a.positionImpulse.y-=d.y*positionImpulse))},d.postSolvePosition=function(e){for(var t=0;t<e.length;t++){var n=e[t];(0!==n.positionImpulse.x||0!==n.positionImpulse.y)&&(n.position.x+=n.positionImpulse.x,n.position.y+=n.positionImpulse.y,n.positionPrev.x+=n.positionImpulse.x,n.positionPrev.y+=n.positionImpulse.y,M.translate(n.vertices,n.positionImpulse),A.update(n.bounds,n.vertices,n.velocity),n.positionImpulse.x*=o,n.positionImpulse.y*=o)}},d.preSolveVelocity=function(e){var t,o,n,i,r,s,a,l,c,d,u,p,v,f,y={};for(t=0;t<e.length;t++)if(n=e[t],n.isActive)for(i=n.activeContacts,r=n.collision,s=r.bodyA,a=r.bodyB,l=r.normal,c=r.tangent,o=0;o<i.length;o++)d=i[o],u=d.vertex,p=d.normalImpulse,v=d.tangentImpulse,y.x=l.x*p+c.x*v,y.y=l.y*p+c.y*v,s.isStatic||s.isSleeping||(f=B.sub(u,s.position),s.positionPrev.x+=y.x*s.inverseMass,s.positionPrev.y+=y.y*s.inverseMass,s.anglePrev+=B.cross(f,y)*s.inverseInertia),a.isStatic||a.isSleeping||(f=B.sub(u,a.position),a.positionPrev.x-=y.x*a.inverseMass,a.positionPrev.y-=y.y*a.inverseMass,a.anglePrev-=B.cross(f,y)*a.inverseInertia)},d.solveVelocity=function(t,o){for(var n={},i=o*o,r=0;r<t.length;r++){var s=t[r];if(s.isActive){var a=s.collision,l=a.bodyA,c=a.bodyB,d=a.normal,u=a.tangent,p=s.activeContacts,v=1/p.length;l.velocity.x=l.position.x-l.positionPrev.x,l.velocity.y=l.position.y-l.positionPrev.y,c.velocity.x=c.position.x-c.positionPrev.x,c.velocity.y=c.position.y-c.positionPrev.y,l.angularVelocity=l.angle-l.anglePrev,c.angularVelocity=c.angle-c.anglePrev;for(var y=0;y<p.length;y++){var m=p[y],x=m.vertex,h=B.sub(x,l.position),g=B.sub(x,c.position),b=B.add(l.velocity,B.mult(B.perp(h),l.angularVelocity)),w=B.add(c.velocity,B.mult(B.perp(g),c.angularVelocity)),S=B.sub(b,w),A=B.dot(d,S),M=B.dot(u,S),C=Math.abs(M),I=f.sign(M),P=(1+s.restitution)*A,k=f.clamp(s.separation+A,0,1),T=M;C>k*s.friction*i&&(T=k*s.friction*i*I);var E=B.cross(h,d),L=B.cross(g,d),R=v/(s.inverseMass+l.inverseInertia*E*E+c.inverseInertia*L*L);if(P*=R,T*=R,0>A&&A*A>e*i)m.normalImpulse=0,m.tangentImpulse=0;else{var V=m.normalImpulse;m.normalImpulse=Math.min(m.normalImpulse+P,0),P=m.normalImpulse-V;var F=m.tangentImpulse;m.tangentImpulse=f.clamp(m.tangentImpulse+T,-C,C),T=m.tangentImpulse-F}n.x=d.x*P+u.x*T,n.y=d.y*P+u.y*T,l.isStatic||l.isSleeping||(l.positionPrev.x+=n.x*l.inverseMass,l.positionPrev.y+=n.y*l.inverseMass,l.anglePrev+=B.cross(h,n)*l.inverseInertia),c.isStatic||c.isSleeping||(c.positionPrev.x-=n.x*c.inverseMass,c.positionPrev.y-=n.y*c.inverseMass,c.anglePrev-=B.cross(g,n)*c.inverseInertia)}}}}}();var u={};!function(){u.collides=function(t,n,i){var r,s,a,l,c=i,d=!1;if(c){var u=t.speed*t.speed+t.angularSpeed*t.angularSpeed+n.speed*n.speed+n.angularSpeed*n.angularSpeed;d=c&&c.collided&&.2>u,l=c}else l={collided:!1,bodyA:t,bodyB:n};if(c&&d){var p=[c.bodyA.axes[c.axisNumber]];if(a=e(c.bodyA.vertices,c.bodyB.vertices,p),l.reused=!0,a.overlap<=0)return l.collided=!1,l}else{if(r=e(t.vertices,n.vertices,t.axes),r.overlap<=0)return l.collided=!1,l;if(s=e(n.vertices,t.vertices,n.axes),s.overlap<=0)return l.collided=!1,l;r.overlap<s.overlap?(a=r,l.bodyA=t,l.bodyB=n):(a=s,l.bodyA=n,l.bodyB=t),l.axisNumber=a.axisNumber}l.collided=!0,l.normal=a.axis,l.depth=a.overlap,t=l.bodyA,n=l.bodyB,B.dot(l.normal,B.sub(n.position,t.position))>0&&(l.normal=B.neg(l.normal)),l.tangent=B.perp(l.normal),l.penetration={x:l.normal.x*l.depth,y:l.normal.y*l.depth};var v=o(t,n,l.normal),f=[v[0]];if(M.contains(t.vertices,v[1]))f.push(v[1]);else{var y=o(n,t,B.neg(l.normal));M.contains(n.vertices,y[0])&&f.push(y[0]),f.length<2&&M.contains(n.vertices,y[1])&&f.push(y[1])}return l.supports=f,l.supportCorrected=B.sub(v[0],l.penetration),l};var e=function(e,o,n){for(var i,r,s={},a={},l={overlap:Number.MAX_VALUE},c=0;c<n.length;c++){if(r=n[c],t(s,e,r),t(a,o,r),i=s.min<a.min?s.max-a.min:a.max-s.min,0>=i)return l.overlap=i,l;i<l.overlap&&(l.overlap=i,l.axis=r,l.axisNumber=c)}return l},t=function(e,t,o){for(var n=B.dot(t[0],o),i=n,r=1;r<t.length;r+=1){var s=B.dot(t[r],o);s>i?i=s:n>s&&(n=s)}e.min=n,e.max=i},o=function(e,t,o){for(var n,i,r=Number.MAX_VALUE,s={x:0,y:0},a=t.vertices,l=e.position,c=a[0],d=a[1],u=0;u<a.length;u++)i=a[u],s.x=i.x-l.x,s.y=i.y-l.y,n=-B.dot(o,s),r>n&&(r=n,c=i);var p=c.index-1>=0?c.index-1:a.length-1;i=a[p],s.x=i.x-l.x,s.y=i.y-l.y,r=-B.dot(o,s),d=i;var v=(c.index+1)%a.length;return i=a[v],s.x=i.x-l.x,s.y=i.y-l.y,n=-B.dot(o,s),r>n&&(r=n,d=i),[c,d]}}();var p={};!function(){var e=1e-6,t=.001;p.create=function(t){var o=t;o.bodyA&&!o.pointA&&(o.pointA={x:0,y:0}),o.bodyB&&!o.pointB&&(o.pointB={x:0,y:0});var n=o.bodyA?B.add(o.bodyA.position,o.pointA):o.pointA,i=o.bodyB?B.add(o.bodyB.position,o.pointB):o.pointB,r=B.magnitude(B.sub(n,i));o.length=o.length||r||e;var s={visible:!0,lineWidth:2,strokeStyle:"#666"};return o.render=f.extend(s,o.render),o.id=o.id||f.nextId(),o.label=o.label||"Constraint",o.type="constraint",o.stiffness=o.stiffness||1,o.angularStiffness=o.angularStiffness||0,o.angleA=o.bodyA?o.bodyA.angle:o.angleA,o.angleB=o.bodyB?o.bodyB.angle:o.angleB,o},p.solveAll=function(e,t){for(var o=0;o<e.length;o++)p.solve(e[o],t)},p.solve=function(o,n){var i=o.bodyA,r=o.bodyB,s=o.pointA,a=o.pointB;i&&!i.isStatic&&(o.pointA=B.rotate(s,i.angle-o.angleA),o.angleA=i.angle),r&&!r.isStatic&&(o.pointB=B.rotate(a,r.angle-o.angleB),o.angleB=r.angle);var l=s,c=a;if(i&&(l=B.add(i.position,s)),r&&(c=B.add(r.position,a)),l&&c){var d=B.sub(l,c),u=B.magnitude(d);0===u&&(u=e);var p=(u-o.length)/u,v=B.div(d,u),y=B.mult(d,.5*p*o.stiffness*n*n);if(!(Math.abs(1-u/o.length)<t*n)){var m,x,h,b,w,S,A,M;i&&!i.isStatic?(h={x:l.x-i.position.x+y.x,y:l.y-i.position.y+y.y},i.velocity.x=i.position.x-i.positionPrev.x,i.velocity.y=i.position.y-i.positionPrev.y,i.angularVelocity=i.angle-i.anglePrev,m=B.add(i.velocity,B.mult(B.perp(h),i.angularVelocity)),w=B.dot(h,v),A=i.inverseMass+i.inverseInertia*w*w):(m={x:0,y:0},A=i?i.inverseMass:0),r&&!r.isStatic?(b={x:c.x-r.position.x-y.x,y:c.y-r.position.y-y.y},r.velocity.x=r.position.x-r.positionPrev.x,r.velocity.y=r.position.y-r.positionPrev.y,r.angularVelocity=r.angle-r.anglePrev,x=B.add(r.velocity,B.mult(B.perp(b),r.angularVelocity)),S=B.dot(b,v),M=r.inverseMass+r.inverseInertia*S*S):(x={x:0,y:0},M=r?r.inverseMass:0);var C=B.sub(x,m),I=B.dot(v,C)/(A+M);I>0&&(I=0);var P,k={x:v.x*I,y:v.y*I};i&&!i.isStatic&&(P=B.cross(h,k)*i.inverseInertia*(1-o.angularStiffness),g.set(i,!1),P=f.clamp(P,-.01,.01),i.constraintImpulse.x-=y.x,i.constraintImpulse.y-=y.y,i.constraintImpulse.angle+=P,i.position.x-=y.x,i.position.y-=y.y,i.angle+=P),r&&!r.isStatic&&(P=B.cross(b,k)*r.inverseInertia*(1-o.angularStiffness),g.set(r,!1),P=f.clamp(P,-.01,.01),r.constraintImpulse.x+=y.x,r.constraintImpulse.y+=y.y,r.constraintImpulse.angle-=P,r.position.x+=y.x,r.position.y+=y.y,r.angle-=P)}}},p.postSolveAll=function(e){for(var t=0;t<e.length;t++){var o=e[t],n=o.constraintImpulse;M.translate(o.vertices,n),0!==n.angle&&(M.rotate(o.vertices,n.angle,o.position),S.rotate(o.axes,n.angle),n.angle=0),A.update(o.bounds,o.vertices),n.x=0,n.y=0}}}();var v={};!function(){v.create=function(e,t){var n=e.input.mouse,i=p.create({label:"Mouse Constraint",pointA:n.position,pointB:{x:0,y:0},length:.01,stiffness:.1,angularStiffness:1,render:{strokeStyle:"#90EE90",lineWidth:3}}),r={type:"mouseConstraint",mouse:n,dragBody:null,dragPoint:null,constraint:i},s=f.extend(r,t);return m.on(e,"tick",function(){var t=o.allBodies(e.world);v.update(s,t)}),s},v.update=function(e,t){var o=e.mouse,n=e.constraint;if(0===o.button){if(!n.bodyB)for(var i=0;i<t.length;i++){var r=t[i];A.contains(r.bounds,o.position)&&M.contains(r.vertices,o.position)&&(n.pointA=o.position,n.bodyB=r,n.pointB={x:o.position.x-r.position.x,y:o.position.y-r.position.y},n.angleB=r.angle,g.set(r,!1))}}else n.bodyB=null,n.pointB=null;n.bodyB&&(g.set(n.bodyB,!1),n.pointA=o.position)}}();var f={};!function(){f._nextId=0,f.extend=function(e,t){var o,n,i;"boolean"==typeof t?(o=2,i=t):(o=1,i=!0),n=Array.prototype.slice.call(arguments,o);for(var r=0;r<n.length;r++){var s=n[r];if(s)for(var a in s)i&&s[a]&&s[a].constructor===Object?e[a]&&e[a].constructor!==Object?e[a]=s[a]:(e[a]=e[a]||{},f.extend(e[a],i,s[a])):e[a]=s[a]}return e},f.clone=function(e,t){return f.extend({},t,e)},f.keys=function(e){if(Object.keys)return Object.keys(e);var t=[];for(var o in e)t.push(o);return t},f.values=function(e){var t=[];if(Object.keys){for(var o=Object.keys(e),n=0;n<o.length;n++)t.push(e[o[n]]);return t}for(var i in e)t.push(e[i]);return t},f.shadeColor=function(e,t){var o=parseInt(e.slice(1),16),n=Math.round(2.55*t),i=(o>>16)+n,r=(o>>8&255)+n,s=(255&o)+n;return"#"+(16777216+65536*(255>i?1>i?0:i:255)+256*(255>r?1>r?0:r:255)+(255>s?1>s?0:s:255)).toString(16).slice(1)},f.shuffle=function(e){for(var t=e.length-1;t>0;t--){var o=Math.floor(Math.random()*(t+1)),n=e[t];e[t]=e[o],e[o]=n}return e},f.choose=function(e){return e[Math.floor(Math.random()*e.length)]},f.isElement=function(e){try{return e instanceof HTMLElement}catch(t){return"object"==typeof e&&1===e.nodeType&&"object"==typeof e.style&&"object"==typeof e.ownerDocument}},f.clamp=function(e,t,o){return t>e?t:e>o?o:e},f.sign=function(e){return 0>e?-1:1},f.now=function(){var e=window.performance;return e?(e.now=e.now||e.webkitNow||e.msNow||e.oNow||e.mozNow,+e.now()):+new Date},f.random=function(e,t){return e+Math.random()*(t-e)},f.colorToNumber=function(e){return e=e.replace("#",""),3==e.length&&(e=e.charAt(0)+e.charAt(0)+e.charAt(1)+e.charAt(1)+e.charAt(2)+e.charAt(2)),parseInt(e,16)},f.log=function(e,t){if(console&&console.log){var o;switch(t){case"warn":o="color: coral";break;case"error":o="color: red"}console.log("%c [Matter] "+t+": "+e,o)}},f.nextId=function(){return f._nextId++}}();var y={};!function(){var e=60,i=e,a=1e3/e,c=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(function(){e(f.now())},a)};y.create=function(t,o){o=f.isElement(t)?o:t,t=f.isElement(t)?t:null;var i={enabled:!0,positionIterations:6,velocityIterations:4,constraintIterations:2,enableSleeping:!1,timeScale:1,input:{},events:[],timing:{fps:e,timestamp:0,delta:a,correction:1,deltaMin:1e3/e,deltaMax:1e3/(.5*e),timeScale:1,isFixed:!1},render:{element:t,controller:C}},c=f.extend(i,o);return c.render=c.render.controller.create(c.render),c.world=n.create(c.world),c.pairs=l.create(),c.metrics=c.metrics||x.create(),c.input.mouse=c.input.mouse||h.create(c.render.canvas),c.broadphase=c.broadphase||{current:"grid",grid:{controller:s,instance:s.create(),detector:r.collisions},bruteForce:{detector:r.bruteForce}},c},y.run=function(e){var t,o=0,n=0,r=[],s=1;!function a(l){if(c(a),e.enabled){var d,p,f=e.timing,x={timestamp:l};m.trigger(e,"beforeTick",x),f.isFixed?d=f.delta:(d=l-t||f.delta,t=l,r.push(d),r=r.slice(-i),d=Math.min.apply(null,r),d=d<f.deltaMin?f.deltaMin:d,d=d>f.deltaMax?f.deltaMax:d,p=d/f.delta,f.delta=d),0!==s&&(p*=f.timeScale/s),0===f.timeScale&&(p=0),s=f.timeScale,n+=1,l-o>=1e3&&(f.fps=n*((l-o)/1e3),o=l,n=0),m.trigger(e,"tick",x),e.world.isModified&&e.render.controller.clear(e.render),y.update(e,d,p),v(e),u(e),y.render(e),m.trigger(e,"afterTick",x)}}()},y.update=function(e,n,i){i="undefined"!=typeof i?i:1;var r,s=e.world,a=e.timing,c=e.broadphase[e.broadphase.current],u=[];a.timestamp+=n*a.timeScale,a.correction=i;var v={timestamp:e.timing.timestamp};m.trigger(e,"beforeUpdate",v);var f=o.allBodies(s),y=o.allConstraints(s);for(x.reset(e.metrics),e.enableSleeping&&g.update(f),t.applyGravityAll(f,s.gravity),t.updateAll(f,n,a.timeScale,i,s.bounds),r=0;r<e.constraintIterations;r++)p.solveAll(y,a.timeScale);p.postSolveAll(f),c.controller?(s.isModified&&c.controller.clear(c.instance),c.controller.update(c.instance,f,e,s.isModified),u=c.instance.pairsList):u=f;var h=c.detector(u,e),b=e.pairs,w=a.timestamp;for(l.update(b,h,w),l.removeOld(b,w),e.enableSleeping&&g.afterCollisions(b.list),d.preSolveVelocity(b.list),r=0;r<e.velocityIterations;r++)d.solveVelocity(b.list,a.timeScale);for(r=0;r<e.positionIterations;r++)d.solvePosition(b.list,a.timeScale);return d.postSolvePosition(f),x.update(e.metrics,e),t.resetForcesAll(f),s.isModified&&o.setModified(s,!1,!1,!0),m.trigger(e,"afterUpdate",v),e},y.render=function(e){var t={timestamp:e.timing.timestamp};m.trigger(e,"beforeRender",t),e.render.controller.world(e),m.trigger(e,"afterRender",t)},y.merge=function(e,t){if(f.extend(e,t),t.world){e.world=t.world,y.clear(e);for(var n=o.allBodies(e.world),i=0;i<n.length;i++){var r=n[i];g.set(r,!1),r.id=f.nextId()}}},y.clear=function(e){var t=e.world;l.clear(e.pairs);var n=e.broadphase[e.broadphase.current];if(n.controller){var i=o.allBodies(t);n.controller.clear(n.instance),n.controller.update(n.instance,i,e,!0)}};var u=function(e){var t=e.input.mouse,o=t.sourceEvents;o.mousemove&&m.trigger(e,"mousemove",{mouse:t}),o.mousedown&&m.trigger(e,"mousedown",{mouse:t}),o.mouseup&&m.trigger(e,"mouseup",{mouse:t}),h.clearSourceEvents(t)},v=function(e){var t=e.pairs;t.collisionStart.length>0&&m.trigger(e,"collisionStart",{pairs:t.collisionStart}),t.collisionActive.length>0&&m.trigger(e,"collisionActive",{pairs:t.collisionActive}),t.collisionEnd.length>0&&m.trigger(e,"collisionEnd",{pairs:t.collisionEnd})}}();var m={};!function(){m.on=function(e,t,o){for(var n,i=t.split(" "),r=0;r<i.length;r++)n=i[r],e.events=e.events||{},e.events[n]=e.events[n]||[],e.events[n].push(o);return o},m.off=function(e,t,o){if(!t)return void(e.events={});"function"==typeof t&&(o=t,t=f.keys(e.events).join(" "));for(var n=t.split(" "),i=0;i<n.length;i++){var r=e.events[n[i]],s=[];if(o)for(var a=0;a<r.length;a++)r[a]!==o&&s.push(r[a]);e.events[n[i]]=s}},m.trigger=function(e,t,o){var n,i,r,s;if(e.events){o||(o={}),n=t.split(" ");for(var a=0;a<n.length;a++)if(i=n[a],r=e.events[i]){s=f.clone(o,!1),s.name=i,s.source=e;for(var l=0;l<r.length;l++)r[l].apply(e,[s])}}}}();var x={};!function(){x.create=function(){return{extended:!1,narrowDetections:0,narrowphaseTests:0,narrowReuse:0,narrowReuseCount:0,midphaseTests:0,broadphaseTests:0,narrowEff:1e-4,midEff:1e-4,broadEff:1e-4,collisions:0,buckets:0,bodies:0,pairs:0}},x.reset=function(e){e.extended&&(e.narrowDetections=0,e.narrowphaseTests=0,e.narrowReuse=0,e.narrowReuseCount=0,e.midphaseTests=0,e.broadphaseTests=0,e.narrowEff=0,e.midEff=0,e.broadEff=0,e.collisions=0,e.buckets=0,e.pairs=0,e.bodies=0)},x.update=function(e,t){if(e.extended){var n=t.world,i=(t.broadphase[t.broadphase.current],o.allBodies(n));e.collisions=e.narrowDetections,e.pairs=t.pairs.list.length,e.bodies=i.length,e.midEff=(e.narrowDetections/(e.midphaseTests||1)).toFixed(2),e.narrowEff=(e.narrowDetections/(e.narrowphaseTests||1)).toFixed(2),e.broadEff=(1-e.broadphaseTests/(i.length||1)).toFixed(2),e.narrowReuse=(e.narrowReuseCount/(e.narrowphaseTests||1)).toFixed(2)}}}();var h;!function(){h=function(t){var o=this;this.element=t||document.body,this.absolute={x:0,y:0},this.position={x:0,y:0},this.mousedownPosition={x:0,y:0},this.mouseupPosition={x:0,y:0},this.offset={x:0,y:0},this.scale={x:1,y:1},this.wheelDelta=0,this.button=-1,this.sourceEvents={mousemove:null,mousedown:null,mouseup:null,mousewheel:null},this.mousemove=function(t){var n=e(t,o.element),i=t.changedTouches;i&&(o.button=0,t.preventDefault()),o.absolute.x=n.x,o.absolute.y=n.y,o.position.x=o.absolute.x*o.scale.x+o.offset.x,o.position.y=o.absolute.y*o.scale.y+o.offset.y,o.sourceEvents.mousemove=t},this.mousedown=function(t){var n=e(t,o.element),i=t.changedTouches;i?(o.button=0,t.preventDefault()):o.button=t.button,o.absolute.x=n.x,o.absolute.y=n.y,o.position.x=o.absolute.x*o.scale.x+o.offset.x,o.position.y=o.absolute.y*o.scale.y+o.offset.y,o.mousedownPosition.x=o.position.x,o.mousedownPosition.y=o.position.y,o.sourceEvents.mousedown=t},this.mouseup=function(t){var n=e(t,o.element),i=t.changedTouches;i&&t.preventDefault(),o.button=-1,o.absolute.x=n.x,o.absolute.y=n.y,o.position.x=o.absolute.x*o.scale.x+o.offset.x,o.position.y=o.absolute.y*o.scale.y+o.offset.y,o.mouseupPosition.x=o.position.x,o.mouseupPosition.y=o.position.y,o.sourceEvents.mouseup=t},this.mousewheel=function(e){o.wheelDelta=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail)),e.preventDefault()},h.setElement(o,o.element)},h.create=function(e){return new h(e)},h.setElement=function(e,t){e.element=t,t.addEventListener("mousemove",e.mousemove),t.addEventListener("mousedown",e.mousedown),t.addEventListener("mouseup",e.mouseup),t.addEventListener("mousewheel",e.mousewheel),t.addEventListener("DOMMouseScroll",e.mousewheel),t.addEventListener("touchmove",e.mousemove),t.addEventListener("touchstart",e.mousedown),t.addEventListener("touchend",e.mouseup)},h.clearSourceEvents=function(e){e.sourceEvents.mousemove=null,e.sourceEvents.mousedown=null,e.sourceEvents.mouseup=null,e.sourceEvents.mousewheel=null,e.wheelDelta=0},h.setOffset=function(e,t){e.offset.x=t.x,e.offset.y=t.y,e.position.x=e.absolute.x*e.scale.x+e.offset.x,e.position.y=e.absolute.y*e.scale.y+e.offset.y},h.setScale=function(e,t){e.scale.x=t.x,e.scale.y=t.y,e.position.x=e.absolute.x*e.scale.x+e.offset.x,e.position.y=e.absolute.y*e.scale.y+e.offset.y};var e=function(e,t){var o,n,i=t.getBoundingClientRect(),r=document.documentElement||document.body.parentNode||document.body,s=void 0!==window.pageXOffset?window.pageXOffset:r.scrollLeft,a=void 0!==window.pageYOffset?window.pageYOffset:r.scrollTop,l=e.changedTouches;return l?(o=l[0].pageX-i.left-s,n=l[0].pageY-i.top-a):(o=e.pageX-i.left-s,n=e.pageY-i.top-a),{x:o/(t.clientWidth/t.width),y:n/(t.clientHeight/t.height)}}}();var g={};!function(){var e=.18,t=.08,o=.9;g.update=function(e){for(var n=0;n<e.length;n++){var i=e[n],r=i.speed*i.speed+i.angularSpeed*i.angularSpeed;if(i.force.x>0||i.force.y>0)g.set(i,!1);else{var s=Math.min(i.motion,r),a=Math.max(i.motion,r);i.motion=o*s+(1-o)*a,i.sleepThreshold>0&&i.motion<t?(i.sleepCounter+=1,i.sleepCounter>=i.sleepThreshold&&g.set(i,!0)):i.sleepCounter>0&&(i.sleepCounter-=1)}}},g.afterCollisions=function(t){for(var o=0;o<t.length;o++){var n=t[o];if(n.isActive){var i=n.collision,r=i.bodyA,s=i.bodyB;if(!(r.isSleeping&&s.isSleeping||r.isStatic||s.isStatic)&&(r.isSleeping||s.isSleeping)){var a=r.isSleeping&&!r.isStatic?r:s,l=a===r?s:r;!a.isStatic&&l.motion>e&&g.set(a,!1)}}}},g.set=function(e,t){t?(e.isSleeping=!0,e.sleepCounter=e.sleepThreshold,e.positionImpulse.x=0,e.positionImpulse.y=0,e.positionPrev.x=e.position.x,e.positionPrev.y=e.position.y,e.anglePrev=e.angle,e.speed=0,e.angularSpeed=0,e.motion=0):(e.isSleeping=!1,e.sleepCounter=0)}}();var b={};!function(){b.rectangle=function(e,o,n,i,r){r=r||{};var s={label:"Rectangle Body",position:{x:e,y:o},vertices:M.fromPath("L 0 0 L "+n+" 0 L "+n+" "+i+" L 0 "+i)};if(r.chamfer){var a=r.chamfer;s.vertices=M.chamfer(s.vertices,a.radius,a.quality,a.qualityMin,a.qualityMax),delete r.chamfer}return t.create(f.extend({},s,r))},b.trapezoid=function(e,o,n,i,r,s){s=s||{},r*=.5;var a=(1-2*r)*n,l=n*r,c=l+a,d=c+l,u={label:"Trapezoid Body",position:{x:e,y:o},vertices:M.fromPath("L 0 0 L "+l+" "+-i+" L "+c+" "+-i+" L "+d+" 0")};
if(s.chamfer){var p=s.chamfer;u.vertices=M.chamfer(u.vertices,p.radius,p.quality,p.qualityMin,p.qualityMax),delete s.chamfer}return t.create(f.extend({},u,s))},b.circle=function(e,t,o,n,i){n=n||{},n.label="Circle Body",i=i||25;var r=Math.ceil(Math.max(10,Math.min(i,o)));return r%2===1&&(r+=1),n.circleRadius=o,b.polygon(e,t,r,o,n)},b.polygon=function(e,o,n,i,r){if(r=r||{},3>n)return b.circle(e,o,i,r);for(var s=2*Math.PI/n,a="",l=.5*s,c=0;n>c;c+=1){var d=l+c*s,u=Math.cos(d)*i,p=Math.sin(d)*i;a+="L "+u.toFixed(3)+" "+p.toFixed(3)+" "}var v={label:"Polygon Body",position:{x:e,y:o},vertices:M.fromPath(a)};if(r.chamfer){var y=r.chamfer;v.vertices=M.chamfer(v.vertices,y.radius,y.quality,y.qualityMin,y.qualityMax),delete r.chamfer}return t.create(f.extend({},v,r))}}();var w={};!function(){w.stack=function(e,n,i,r,s,a,l){for(var c,d=o.create({label:"Stack"}),u=e,p=n,v=0,f=0;r>f;f++){for(var y=0,m=0;i>m;m++){var x=l(u,p,m,f,c,v);if(x){var h=x.bounds.max.y-x.bounds.min.y,g=x.bounds.max.x-x.bounds.min.x;h>y&&(y=h),t.translate(x,{x:.5*g,y:.5*h}),u=x.bounds.max.x+s,o.addBody(d,x),c=x,v+=1}}p+=y+a,u=e}return d},w.chain=function(e,t,n,i,r,s){for(var a=e.bodies,l=1;l<a.length;l++){var c=a[l-1],d=a[l],u=c.bounds.max.y-c.bounds.min.y,v=c.bounds.max.x-c.bounds.min.x,y=d.bounds.max.y-d.bounds.min.y,m=d.bounds.max.x-d.bounds.min.x,x={bodyA:c,pointA:{x:v*t,y:u*n},bodyB:d,pointB:{x:m*i,y:y*r}},h=f.extend(x,s);o.addConstraint(e,p.create(h))}return e.label+=" Chain",e},w.mesh=function(e,t,n,i,r){var s,a,l,c,d,u=e.bodies;for(s=0;n>s;s++){for(a=0;t>a;a++)a>0&&(l=u[a-1+s*t],c=u[a+s*t],o.addConstraint(e,p.create(f.extend({bodyA:l,bodyB:c},r))));for(a=0;t>a;a++)s>0&&(l=u[a+(s-1)*t],c=u[a+s*t],o.addConstraint(e,p.create(f.extend({bodyA:l,bodyB:c},r))),i&&a>0&&(d=u[a-1+(s-1)*t],o.addConstraint(e,p.create(f.extend({bodyA:d,bodyB:c},r)))),i&&t-1>a&&(d=u[a+1+(s-1)*t],o.addConstraint(e,p.create(f.extend({bodyA:d,bodyB:c},r)))))}return e.label+=" Mesh",e},w.pyramid=function(e,o,n,i,r,s,a){return w.stack(e,o,n,i,r,s,function(o,s,l,c,d,u){var p=Math.min(i,Math.ceil(n/2)),v=d?d.bounds.max.x-d.bounds.min.x:0;if(!(c>p)){c=p-c;var f=c,y=n-1-c;if(!(f>l||l>y)){1===u&&t.translate(d,{x:(l+(n%2===1?1:-1))*v,y:0});var m=d?l*v:0;return a(e+m+l*r,s,l,c,d,u)}}})},w.newtonsCradle=function(e,t,n,i,r){for(var s=o.create({label:"Newtons Cradle"}),a=0;n>a;a++){var l=1.9,c=b.circle(e+a*i*l,t+r,i,{inertia:99999,restitution:1,friction:0,frictionAir:1e-4,slop:.01}),d=p.create({pointA:{x:e+a*i*l,y:t},bodyB:c});o.addBody(s,c),o.addConstraint(s,d)}return s},w.car=function(e,n,i,r,s){var a=t.nextGroupId(),l=-20,c=.5*-i+l,d=.5*i-l,u=0,v=o.create({label:"Car"}),f=b.trapezoid(e,n,i,r,.3,{groupId:a,friction:.01,chamfer:{radius:10}}),y=b.circle(e+c,n+u,s,{groupId:a,restitution:.5,friction:.9,density:.01}),m=b.circle(e+d,n+u,s,{groupId:a,restitution:.5,friction:.9,density:.01}),x=p.create({bodyA:f,pointA:{x:c,y:u},bodyB:y,stiffness:.5}),h=p.create({bodyA:f,pointA:{x:d,y:u},bodyB:m,stiffness:.5});return o.addBody(v,f),o.addBody(v,y),o.addBody(v,m),o.addConstraint(v,x),o.addConstraint(v,h),v},w.softBody=function(e,t,o,n,i,r,s,a,l,c){l=f.extend({inertia:1/0},l),c=f.extend({stiffness:.4},c);var d=w.stack(e,t,o,n,i,r,function(e,t){return b.circle(e,t,a,l)});return w.mesh(d,o,n,s,c),d.label="Soft Body",d}}();var S={};!function(){S.fromVertices=function(e){for(var t={},o=0;o<e.length;o++){var n=(o+1)%e.length,i=B.normalise({x:e[n].y-e[o].y,y:e[o].x-e[n].x}),r=0===i.y?1/0:i.x/i.y;r=r.toFixed(3).toString(),t[r]=i}return f.values(t)},S.rotate=function(e,t){if(0!==t)for(var o=Math.cos(t),n=Math.sin(t),i=0;i<e.length;i++){var r,s=e[i];r=s.x*o-s.y*n,s.y=s.x*n+s.y*o,s.x=r}}}();var A={};!function(){A.create=function(e){var t={min:{x:0,y:0},max:{x:0,y:0}};return e&&A.update(t,e),t},A.update=function(e,t,o){e.min.x=Number.MAX_VALUE,e.max.x=Number.MIN_VALUE,e.min.y=Number.MAX_VALUE,e.max.y=Number.MIN_VALUE;for(var n=0;n<t.length;n++){var i=t[n];i.x>e.max.x&&(e.max.x=i.x),i.x<e.min.x&&(e.min.x=i.x),i.y>e.max.y&&(e.max.y=i.y),i.y<e.min.y&&(e.min.y=i.y)}o&&(o.x>0?e.max.x+=o.x:e.min.x+=o.x,o.y>0?e.max.y+=o.y:e.min.y+=o.y)},A.contains=function(e,t){return t.x>=e.min.x&&t.x<=e.max.x&&t.y>=e.min.y&&t.y<=e.max.y},A.overlaps=function(e,t){return e.min.x<=t.max.x&&e.max.x>=t.min.x&&e.max.y>=t.min.y&&e.min.y<=t.max.y},A.translate=function(e,t){e.min.x+=t.x,e.max.x+=t.x,e.min.y+=t.y,e.max.y+=t.y},A.shift=function(e,t){var o=e.max.x-e.min.x,n=e.max.y-e.min.y;e.min.x=t.x,e.max.x=t.x+o,e.min.y=t.y,e.max.y=t.y+n}}();var B={};!function(){B.magnitude=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},B.magnitudeSquared=function(e){return e.x*e.x+e.y*e.y},B.rotate=function(e,t){var o=Math.cos(t),n=Math.sin(t);return{x:e.x*o-e.y*n,y:e.x*n+e.y*o}},B.rotateAbout=function(e,t,o){var n=Math.cos(t),i=Math.sin(t);return{x:o.x+((e.x-o.x)*n-(e.y-o.y)*i),y:o.y+((e.x-o.x)*i+(e.y-o.y)*n)}},B.normalise=function(e){var t=B.magnitude(e);return 0===t?{x:0,y:0}:{x:e.x/t,y:e.y/t}},B.dot=function(e,t){return e.x*t.x+e.y*t.y},B.cross=function(e,t){return e.x*t.y-e.y*t.x},B.add=function(e,t){return{x:e.x+t.x,y:e.y+t.y}},B.sub=function(e,t){return{x:e.x-t.x,y:e.y-t.y}},B.mult=function(e,t){return{x:e.x*t,y:e.y*t}},B.div=function(e,t){return{x:e.x/t,y:e.y/t}},B.perp=function(e,t){return t=t===!0?-1:1,{x:t*-e.y,y:t*e.x}},B.neg=function(e){return{x:-e.x,y:-e.y}},B.angle=function(e,t){return Math.atan2(t.y-e.y,t.x-e.x)}}();var M={};!function(){M.create=function(e,t){for(var o=0;o<e.length;o++)e[o].index=o,e[o].body=t},M.fromPath=function(e){var t=/L\s*([\-\d\.]*)\s*([\-\d\.]*)/gi,o=[];return e.replace(t,function(e,t,n){o.push({x:parseFloat(t,10),y:parseFloat(n,10)})}),o},M.centre=function(e){for(var t,o,n,i=M.area(e,!0),r={x:0,y:0},s=0;s<e.length;s++)n=(s+1)%e.length,t=B.cross(e[s],e[n]),o=B.mult(B.add(e[s],e[n]),t),r=B.add(r,o);return B.div(r,6*i)},M.area=function(e,t){for(var o=0,n=e.length-1,i=0;i<e.length;i++)o+=(e[n].x-e[i].x)*(e[n].y+e[i].y),n=i;return t?o/2:Math.abs(o)/2},M.inertia=function(e,t){for(var o,n,i=0,r=0,s=e,a=0;a<s.length;a++)n=(a+1)%s.length,o=Math.abs(B.cross(s[n],s[a])),i+=o*(B.dot(s[n],s[n])+B.dot(s[n],s[a])+B.dot(s[a],s[a])),r+=o;return t/6*(i/r)},M.translate=function(e,t,o){var n;if(o)for(n=0;n<e.length;n++)e[n].x+=t.x*o,e[n].y+=t.y*o;else for(n=0;n<e.length;n++)e[n].x+=t.x,e[n].y+=t.y},M.rotate=function(e,t,o){if(0!==t)for(var n=Math.cos(t),i=Math.sin(t),r=0;r<e.length;r++){var s=e[r],a=s.x-o.x,l=s.y-o.y;s.x=o.x+(a*n-l*i),s.y=o.y+(a*i+l*n)}},M.contains=function(e,t){for(var o=0;o<e.length;o++){var n=e[o],i=e[(o+1)%e.length];if((t.x-n.x)*(i.y-n.y)+(t.y-n.y)*(n.x-i.x)>0)return!1}return!0},M.scale=function(e,t,o,n){if(1===t&&1===o)return e;n=n||M.centre(e);for(var i,r,s=0;s<e.length;s++)i=e[s],r=B.sub(i,n),e[s].x=n.x+r.x*t,e[s].y=n.y+r.y*o;return e},M.chamfer=function(e,t,o,n,i){t=t||[8],t.length||(t=[t]),o="undefined"!=typeof o?o:-1,n=n||2,i=i||14;for(var r=(M.centre(e),[]),s=0;s<e.length;s++){var a=e[s-1>=0?s-1:e.length-1],l=e[s],c=e[(s+1)%e.length],d=t[s<t.length?s:t.length-1];if(0!==d){var u=B.normalise({x:l.y-a.y,y:a.x-l.x}),p=B.normalise({x:c.y-l.y,y:l.x-c.x}),v=Math.sqrt(2*Math.pow(d,2)),y=B.mult(f.clone(u),d),m=B.normalise(B.mult(B.add(u,p),.5)),x=B.sub(l,B.mult(m,v)),h=o;-1===o&&(h=1.75*Math.pow(d,.32)),h=f.clamp(h,n,i),h%2===1&&(h+=1);for(var g=Math.acos(B.dot(u,p)),b=g/h,w=0;h>w;w++)r.push(B.add(B.rotate(y,b*w),x))}else r.push(l)}return r}}();var C={};!function(){C.create=function(t){var o={controller:C,element:null,canvas:null,options:{width:800,height:600,background:"#fafafa",wireframeBackground:"#222",hasBounds:!1,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showShadows:!1}},n=f.extend(o,t);return n.canvas=n.canvas||e(n.options.width,n.options.height),n.context=n.canvas.getContext("2d"),n.textures={},n.bounds=n.bounds||{min:{x:0,y:0},max:{x:n.options.width,y:n.options.height}},C.setBackground(n,n.options.background),f.isElement(n.element)?n.element.appendChild(n.canvas):f.log('No "render.element" passed, "render.canvas" was not inserted into document.',"warn"),n},C.clear=function(){},C.setBackground=function(e,t){if(e.currentBackground!==t){var o=t;/(jpg|gif|png)$/.test(t)&&(o="url("+t+")"),e.canvas.style.background=o,e.canvas.style.backgroundSize="contain",e.currentBackground=t}},C.world=function(e){var t,n=e.render,i=e.world,r=n.canvas,s=n.context,a=n.options,l=o.allBodies(i),c=o.allConstraints(i),d=[],u=[];a.wireframes?C.setBackground(n,a.wireframeBackground):C.setBackground(n,a.background),s.globalCompositeOperation="source-in",s.fillStyle="transparent",s.fillRect(0,0,r.width,r.height),s.globalCompositeOperation="source-over";var p=n.bounds.max.x-n.bounds.min.x,v=n.bounds.max.y-n.bounds.min.y,f=p/n.options.width,y=v/n.options.height;if(a.hasBounds){for(t=0;t<l.length;t++){var m=l[t];A.overlaps(m.bounds,n.bounds)&&d.push(m)}for(t=0;t<c.length;t++){var x=c[t],h=x.bodyA,g=x.bodyB,b=x.pointA,w=x.pointB;h&&(b=B.add(h.position,x.pointA)),g&&(w=B.add(g.position,x.pointB)),b&&w&&(A.contains(n.bounds,b)||A.contains(n.bounds,w))&&u.push(x)}s.scale(1/f,1/y),s.translate(-n.bounds.min.x,-n.bounds.min.y)}else u=c,d=l;!a.wireframes||e.enableSleeping&&a.showSleeping?C.bodies(e,d,s):C.bodyWireframes(e,d,s),a.showBounds&&C.bodyBounds(e,d,s),(a.showAxes||a.showAngleIndicator)&&C.bodyAxes(e,d,s),a.showPositions&&C.bodyPositions(e,d,s),a.showVelocity&&C.bodyVelocity(e,d,s),a.showIds&&C.bodyIds(e,d,s),a.showCollisions&&C.collisions(e,e.pairs.list,s),C.constraints(u,s),a.showBroadphase&&"grid"===e.broadphase.current&&C.grid(e,e.broadphase[e.broadphase.current].instance,s),a.showDebug&&C.debug(e,s),a.hasBounds&&s.setTransform(1,0,0,1,0,0)},C.debug=function(e,t){var n=t,i=e.world,r=e.render,a=r.options,l=o.allBodies(i),c="    ";if(e.timing.timestamp-(r.debugTimestamp||0)>=500){var d="";d+="fps: "+Math.round(e.timing.fps)+c,e.metrics.extended&&(d+="delta: "+e.timing.delta.toFixed(3)+c,d+="correction: "+e.timing.correction.toFixed(3)+c,d+="bodies: "+l.length+c,e.broadphase.controller===s&&(d+="buckets: "+e.metrics.buckets+c),d+="\n",d+="collisions: "+e.metrics.collisions+c,d+="pairs: "+e.pairs.list.length+c,d+="broad: "+e.metrics.broadEff+c,d+="mid: "+e.metrics.midEff+c,d+="narrow: "+e.metrics.narrowEff+c),r.debugString=d,r.debugTimestamp=e.timing.timestamp}if(r.debugString){n.font="12px Arial",n.fillStyle=a.wireframes?"rgba(255,255,255,0.5)":"rgba(0,0,0,0.5)";for(var u=r.debugString.split("\n"),p=0;p<u.length;p++)n.fillText(u[p],50,50+18*p)}},C.constraints=function(e,t){for(var o=t,n=0;n<e.length;n++){var i=e[n];if(i.render.visible&&i.pointA&&i.pointB){var r=i.bodyA,s=i.bodyB;r?(o.beginPath(),o.moveTo(r.position.x+i.pointA.x,r.position.y+i.pointA.y)):(o.beginPath(),o.moveTo(i.pointA.x,i.pointA.y)),s?o.lineTo(s.position.x+i.pointB.x,s.position.y+i.pointB.y):o.lineTo(i.pointB.x,i.pointB.y),o.lineWidth=i.render.lineWidth,o.strokeStyle=i.render.strokeStyle,o.stroke()}}},C.bodyShadows=function(e,t,o){for(var n=o,i=e.render,r=(i.options,0);r<t.length;r++){var s=t[r];if(s.render.visible){if(s.circleRadius)n.beginPath(),n.arc(s.position.x,s.position.y,s.circleRadius,0,2*Math.PI),n.closePath();else{n.beginPath(),n.moveTo(s.vertices[0].x,s.vertices[0].y);for(var a=1;a<s.vertices.length;a++)n.lineTo(s.vertices[a].x,s.vertices[a].y);n.closePath()}var l=s.position.x-.5*i.options.width,c=s.position.y-.2*i.options.height,d=Math.abs(l)+Math.abs(c);n.shadowColor="rgba(0,0,0,0.15)",n.shadowOffsetX=.05*l,n.shadowOffsetY=.05*c,n.shadowBlur=1+12*Math.min(1,d/1e3),n.fill(),n.shadowColor=null,n.shadowOffsetX=null,n.shadowOffsetY=null,n.shadowBlur=null}}},C.bodies=function(e,o,n){var i,r=n,s=e.render,a=s.options;for(i=0;i<o.length;i++){var l=o[i];if(l.render.visible)if(l.render.sprite&&l.render.sprite.texture&&!a.wireframes){var c=l.render.sprite,d=t(s,c.texture);a.showSleeping&&l.isSleeping&&(r.globalAlpha=.5),r.translate(l.position.x,l.position.y),r.rotate(l.angle),r.drawImage(d,d.width*-.5*c.xScale,d.height*-.5*c.yScale,d.width*c.xScale,d.height*c.yScale),r.rotate(-l.angle),r.translate(-l.position.x,-l.position.y),a.showSleeping&&l.isSleeping&&(r.globalAlpha=1)}else{if(l.circleRadius)r.beginPath(),r.arc(l.position.x,l.position.y,l.circleRadius,0,2*Math.PI);else{r.beginPath(),r.moveTo(l.vertices[0].x,l.vertices[0].y);for(var u=1;u<l.vertices.length;u++)r.lineTo(l.vertices[u].x,l.vertices[u].y);r.closePath()}a.wireframes?(r.lineWidth=1,r.strokeStyle="#bbb",a.showSleeping&&l.isSleeping&&(r.strokeStyle="rgba(255,255,255,0.2)"),r.stroke()):(r.fillStyle=a.showSleeping&&l.isSleeping?f.shadeColor(l.render.fillStyle,50):l.render.fillStyle,r.lineWidth=l.render.lineWidth,r.strokeStyle=l.render.strokeStyle,r.fill(),r.stroke())}}},C.bodyWireframes=function(e,t,o){var n,i,r=o;for(r.beginPath(),n=0;n<t.length;n++){var s=t[n];if(s.render.visible){for(r.moveTo(s.vertices[0].x,s.vertices[0].y),i=1;i<s.vertices.length;i++)r.lineTo(s.vertices[i].x,s.vertices[i].y);r.lineTo(s.vertices[0].x,s.vertices[0].y)}}r.lineWidth=1,r.strokeStyle="#bbb",r.stroke()},C.bodyBounds=function(e,t,o){var n=o,i=e.render,r=i.options;n.beginPath();for(var s=0;s<t.length;s++){var a=t[s];a.render.visible&&n.rect(a.bounds.min.x,a.bounds.min.y,a.bounds.max.x-a.bounds.min.x,a.bounds.max.y-a.bounds.min.y)}n.strokeStyle=r.wireframes?"rgba(255,255,255,0.08)":"rgba(0,0,0,0.1)",n.lineWidth=1,n.stroke()},C.bodyAxes=function(e,t,o){var n,i,r=o,s=e.render,a=s.options;for(r.beginPath(),n=0;n<t.length;n++){var l=t[n];if(l.render.visible)if(a.showAxes)for(i=0;i<l.axes.length;i++){var c=l.axes[i];r.moveTo(l.position.x,l.position.y),r.lineTo(l.position.x+20*c.x,l.position.y+20*c.y)}else r.moveTo(l.position.x,l.position.y),r.lineTo((l.vertices[0].x+l.vertices[l.vertices.length-1].x)/2,(l.vertices[0].y+l.vertices[l.vertices.length-1].y)/2)}r.strokeStyle=a.wireframes?"indianred":"rgba(0,0,0,0.3)",r.lineWidth=1,r.stroke()},C.bodyPositions=function(e,t,o){var n,i,r=o,s=e.render,a=s.options;for(r.beginPath(),i=0;i<t.length;i++)n=t[i],n.render.visible&&(r.arc(n.position.x,n.position.y,3,0,2*Math.PI,!1),r.closePath());for(r.fillStyle=a.wireframes?"indianred":"rgba(0,0,0,0.5)",r.fill(),r.beginPath(),i=0;i<t.length;i++)n=t[i],n.render.visible&&(r.arc(n.positionPrev.x,n.positionPrev.y,2,0,2*Math.PI,!1),r.closePath());r.fillStyle="rgba(255,165,0,0.8)",r.fill()},C.bodyVelocity=function(e,t,o){{var n=o,i=e.render;i.options}n.beginPath();for(var r=0;r<t.length;r++){var s=t[r];s.render.visible&&(n.moveTo(s.position.x,s.position.y),n.lineTo(s.position.x+2*(s.position.x-s.positionPrev.x),s.position.y+2*(s.position.y-s.positionPrev.y)))}n.lineWidth=3,n.strokeStyle="cornflowerblue",n.stroke()},C.bodyIds=function(e,t,o){for(var n=o,i=0;i<t.length;i++){var r=t[i];r.render.visible&&(n.font="12px Arial",n.fillStyle="rgba(255,255,255,0.5)",n.fillText(r.id,r.position.x+10,r.position.y-10))}},C.collisions=function(e,t,o){var n,i,r,s,a=o,l=e.render.options;for(a.beginPath(),r=0;r<t.length;r++)for(n=t[r],i=n.collision,s=0;s<n.activeContacts.length;s++){var c=n.activeContacts[s],d=c.vertex;a.rect(d.x-1.5,d.y-1.5,3.5,3.5)}for(a.fillStyle=l.wireframes?"rgba(255,255,255,0.7)":"orange",a.fill(),a.beginPath(),r=0;r<t.length;r++)if(n=t[r],i=n.collision,n.activeContacts.length>0){var u=n.activeContacts[0].vertex.x,p=n.activeContacts[0].vertex.y;2===n.activeContacts.length&&(u=(n.activeContacts[0].vertex.x+n.activeContacts[1].vertex.x)/2,p=(n.activeContacts[0].vertex.y+n.activeContacts[1].vertex.y)/2),a.moveTo(u-8*i.normal.x,p-8*i.normal.y),a.lineTo(u,p)}a.strokeStyle=l.wireframes?"rgba(255,165,0,0.7)":"orange",a.lineWidth=1,a.stroke()},C.grid=function(e,t,o){var n=o,i=e.render.options;n.strokeStyle=i.wireframes?"rgba(255,180,0,0.1)":"rgba(255,180,0,0.5)",n.beginPath();for(var r=f.keys(t.buckets),s=0;s<r.length;s++){var a=r[s];if(!(t.buckets[a].length<2)){var l=a.split(",");n.rect(.5+parseInt(l[0],10)*t.bucketWidth,.5+parseInt(l[1],10)*t.bucketHeight,t.bucketWidth,t.bucketHeight)}}n.lineWidth=1,n.stroke()},C.inspector=function(e,t){var o,n=e.engine,i=(n.input.mouse,e.selected),r=n.render,s=r.options;if(s.hasBounds){var a=r.bounds.max.x-r.bounds.min.x,l=r.bounds.max.y-r.bounds.min.y,c=a/r.options.width,d=l/r.options.height;t.scale(1/c,1/d),t.translate(-r.bounds.min.x,-r.bounds.min.y)}for(var u=0;u<i.length;u++){var p=i[u].data;switch(t.translate(.5,.5),t.lineWidth=1,t.strokeStyle="rgba(255,165,0,0.9)",t.setLineDash([1,2]),p.type){case"body":o=p.bounds,t.beginPath(),t.rect(Math.floor(o.min.x-3),Math.floor(o.min.y-3),Math.floor(o.max.x-o.min.x+6),Math.floor(o.max.y-o.min.y+6)),t.closePath(),t.stroke();break;case"constraint":var v=p.pointA;p.bodyA&&(v=p.pointB),t.beginPath(),t.arc(v.x,v.y,10,0,2*Math.PI),t.closePath(),t.stroke()}t.setLineDash([0]),t.translate(-.5,-.5)}null!==e.selectStart&&(t.translate(.5,.5),t.lineWidth=1,t.strokeStyle="rgba(255,165,0,0.6)",t.fillStyle="rgba(255,165,0,0.1)",o=e.selectBounds,t.beginPath(),t.rect(Math.floor(o.min.x),Math.floor(o.min.y),Math.floor(o.max.x-o.min.x),Math.floor(o.max.y-o.min.y)),t.closePath(),t.stroke(),t.fill(),t.translate(-.5,-.5)),s.hasBounds&&t.setTransform(1,0,0,1,0,0)};var e=function(e,t){var o=document.createElement("canvas");return o.width=e,o.height=t,o.oncontextmenu=function(){return!1},o.onselectstart=function(){return!1},o},t=function(e,t){var o=e.textures[t];return o?o:(o=e.textures[t]=new Image,o.src=t,o)}}();var I={};!function(){I.create=function(e){var t={controller:I,element:null,canvas:null,options:{width:800,height:600,background:"#fafafa",wireframeBackground:"#222",enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showShadows:!1}},o=f.extend(t,e);return o.context=new PIXI.WebGLRenderer(800,600,o.canvas,!1,!0),o.canvas=o.context.view,o.stage=new PIXI.Stage,o.textures={},o.sprites={},o.primitives={},o.spriteBatch=new PIXI.SpriteBatch,o.stage.addChild(o.spriteBatch),f.isElement(o.element)?o.element.appendChild(o.canvas):f.log('No "render.element" passed, "render.canvas" was not inserted into document.',"warn"),o.canvas.oncontextmenu=function(){return!1},o.canvas.onselectstart=function(){return!1},o},I.clear=function(e){for(var t=e.stage,o=e.spriteBatch;t.children[0];)t.removeChild(t.children[0]);for(;o.children[0];)o.removeChild(o.children[0]);var n=e.sprites["bg-0"];e.textures={},e.sprites={},e.primitives={},e.sprites["bg-0"]=n,n&&o.addChildAt(n,0),e.stage.addChild(e.spriteBatch),e.currentBackground=null},I.setBackground=function(e,t){if(e.currentBackground!==t){var o=t.indexOf&&-1!==t.indexOf("#"),i=e.sprites["bg-0"];if(o){var r=f.colorToNumber(t);e.stage.setBackgroundColor(r),i&&e.spriteBatch.removeChild(i)}else if(!i){var s=n(e,t);i=e.sprites["bg-0"]=new PIXI.Sprite(s),i.position.x=0,i.position.y=0,e.spriteBatch.addChildAt(i,0)}e.currentBackground=t}},I.world=function(e){var t,n=e.render,i=e.world,r=n.context,s=n.stage,a=n.options,l=o.allBodies(i),c=o.allConstraints(i);for(a.wireframes?I.setBackground(n,a.wireframeBackground):I.setBackground(n,a.background),t=0;t<l.length;t++)I.body(e,l[t]);for(t=0;t<c.length;t++)I.constraint(e,c[t]);r.render(s)},I.constraint=function(e,t){var o=e.render,n=t.bodyA,i=t.bodyB,r=t.pointA,s=t.pointB,a=o.stage,l=t.render,c="c-"+t.id,d=o.primitives[c];return d||(d=o.primitives[c]=new PIXI.Graphics),l.visible&&t.pointA&&t.pointB?(-1===a.children.indexOf(d)&&a.addChild(d),d.clear(),d.beginFill(0,0),d.lineStyle(l.lineWidth,f.colorToNumber(l.strokeStyle),1),n?d.moveTo(n.position.x+r.x,n.position.y+r.y):d.moveTo(r.x,r.y),i?d.lineTo(i.position.x+s.x,i.position.y+s.y):d.lineTo(s.x,s.y),void d.endFill()):void d.clear()},I.body=function(o,n){var i=o.render,r=n.render;if(r.visible)if(r.sprite&&r.sprite.texture){var s="b-"+n.id,a=i.sprites[s],l=i.spriteBatch;a||(a=i.sprites[s]=e(i,n)),-1===l.children.indexOf(a)&&l.addChild(a),a.position.x=n.position.x,a.position.y=n.position.y,a.rotation=n.angle}else{var c="b-"+n.id,d=i.primitives[c],u=i.stage;d||(d=i.primitives[c]=t(i,n),d.initialAngle=n.angle),-1===u.children.indexOf(d)&&u.addChild(d),d.position.x=n.position.x,d.position.y=n.position.y,d.rotation=n.angle-d.initialAngle}};var e=function(e,t){var o=t.render,i=o.sprite.texture,r=n(e,i),s=new PIXI.Sprite(r);return s.anchor.x=.5,s.anchor.y=.5,s},t=function(e,t){var o=t.render,n=e.options,i=new PIXI.Graphics;i.clear(),n.wireframes?(i.beginFill(0,0),i.lineStyle(1,f.colorToNumber("#bbb"),1)):(i.beginFill(f.colorToNumber(o.fillStyle),1),i.lineStyle(t.render.lineWidth,f.colorToNumber(o.strokeStyle),1)),i.moveTo(t.vertices[0].x-t.position.x,t.vertices[0].y-t.position.y);for(var r=1;r<t.vertices.length;r++)i.lineTo(t.vertices[r].x-t.position.x,t.vertices[r].y-t.position.y);return i.lineTo(t.vertices[0].x-t.position.x,t.vertices[0].y-t.position.y),i.endFill(),(n.showAngleIndicator||n.showAxes)&&(i.beginFill(0,0),n.wireframes?i.lineStyle(1,f.colorToNumber("#CD5C5C"),1):i.lineStyle(1,f.colorToNumber(t.render.strokeStyle)),i.moveTo(0,0),i.lineTo((t.vertices[0].x+t.vertices[t.vertices.length-1].x)/2-t.position.x,(t.vertices[0].y+t.vertices[t.vertices.length-1].y)/2-t.position.y),i.endFill()),i},n=function(e,t){var o=e.textures[t];return o||(o=e.textures[t]=PIXI.Texture.fromImage(t)),o}}(),n.add=o.add,n.remove=o.remove,n.addComposite=o.addComposite,n.addBody=o.addBody,n.addConstraint=o.addConstraint,n.clear=o.clear,e.Body=t,e.Composite=o,e.World=n,e.Contact=i,e.Detector=r,e.Grid=s,e.Pairs=l,e.Pair=a,e.Resolver=d,e.SAT=u,e.Constraint=p,e.MouseConstraint=v,e.Common=f,e.Engine=y,e.Metrics=x,e.Mouse=h,e.Sleeping=g,e.Bodies=b,e.Composites=w,e.Axes=S,e.Bounds=A,e.Vector=B,e.Vertices=M,e.Render=C,e.RenderPixi=I,e.Events=m,e.Query=c,"undefined"!=typeof exports&&("undefined"!=typeof module&&module.exports&&(exports=module.exports=e),exports.Matter=e),"function"==typeof define&&define.amd&&define("Matter",[],function(){return e}),"object"==typeof window&&"object"==typeof window.document&&(window.Matter=e)}();